<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Household Dashboard - EcoCompost</title>
    <link rel="stylesheet" href="css/household-dashboard.css">

    <!-- ‚úÖ FIXED: Leaflet without integrity checks -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="68" height="68" viewBox="0 0 32 32" fill="none">
                    <!-- Darker green circular background (updated color) -->
                    <circle cx="16" cy="16" r="15" fill="#00A63E"></circle>

                    <!-- White-edged leaf with padding (scaled and centered) -->
                    <g transform="translate(3,3) scale(0.82)">
                        <path d="M15 25A7 7 0 0 1 13.8 11.1C19.5 10 21 9.48 23 7c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"
                            stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            fill="none"></path>
                        <path d="M6 26c0-3 1.85-5.36 5.08-6C13.5 19.52 16 18 17 17" stroke="white" stroke-width="2.5"
                            stroke-linecap="round" str="" oke-linejoin="round" fill="none"></path>
                    </g>
                </svg>
                <span>Waste2Wealth</span>
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link active" data-section="dashboard">Dashboard</a>
                <a href="#" class="nav-link" data-section="request-pickup">Request Pickup</a>
                <a href="#" class="nav-link" data-section="pickup-history">History</a>
                <a href="#" class="nav-link" data-section="rewards">Rewards</a>
            </div>
            <div class="nav-actions">
                <div class="points-display">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-gift h-4 w-4" aria-hidden="true">
                        <rect x="3" y="8" width="18" height="4" rx="1"></rect>
                        <path d="M12 8v13"></path>
                        <path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"></path>
                        <path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"></path>
                    </svg>
                    <span id="totalPoints">1850</span>
                </div>
                <div class="notification-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                </div>
                <div class="user-avatar">
                    <span id="userInitial">H</span>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Dashboard Section -->
    <div id="dashboard-section" class="section active">
        <div class="dashboard-container">
            <!-- Welcome Section -->
            <div class="welcome-section">
                <h1>Welcome back, <span id="userName">Household</span>!</h1>
                <p>Here's your impact on creating a sustainable environment</p>
            </div>

            <!-- Key Metrics -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon gold">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-gift h-4 w-4" aria-hidden="true">
                            <rect x="3" y="8" width="18" height="4" rx="1"></rect>
                            <path d="M12 8v13"></path>
                            <path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"></path>
                            <path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5">
                            </path>
                        </svg>
                    </div>
                    <div class="metric-info">
                        <h3>Total Points</h3>
                        <p class="metric-value" id="metricPoints">1850</p>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon green">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-package h-8 w-8 text-green-600" aria-hidden="true">
                            <path
                                d="M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z">
                            </path>
                            <path d="M12 22V12"></path>
                            <polyline points="3.29 7 12 12 20.71 7"></polyline>
                            <path d="m7.5 4.27 9 5.15"></path>
                        </svg>
                    </div>
                    <div class="metric-info">
                        <h3>Waste Processed</h3>
                        <p class="metric-value" id="metricWaste">0 kg</p>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon blue">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"></path>
                            <path d="M15 18H9"></path>
                            <path d="M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14">
                            </path>
                            <circle cx="17" cy="18" r="2"></circle>
                            <circle cx="7" cy="18" r="2"></circle>
                        </svg>
                    </div>
                    <div class="metric-info">
                        <h3>Total Pickups</h3>
                        <p class="metric-value" id="metricPickups">0</p>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon purple">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 7h6v6"></path>
                            <path d="m22 7-8.5 8.5-5-5L2 17"></path>
                        </svg>
                    </div>
                    <div class="metric-info">
                        <h3>CO‚ÇÇ Saved</h3>
                        <p class="metric-value" id="metricCO2">0 kg</p>
                    </div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="content-grid">
                <!-- Left Column: Recent Pickups -->
                <div class="content-card">
                    <h2>Recent Pickups</h2>
                    <div id="recentPickups">
                        <!-- Pickup items will be loaded here -->
                    </div>
                </div>

                <!-- Right Column: Quick Actions & Monthly Goal -->
                <div class="content-column">
                    <!-- Quick Actions -->
                    <div class="content-card">
                        <h2>Quick Actions</h2>
                        <div class="quick-actions">
                            <button class="action-btn primary" onclick="showSection('request-pickup')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                Schedule Pickup
                            </button>
                            <button class="action-btn" onclick="showSection('pickup-history')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                View History
                            </button>
                            <button class="action-btn" onclick="showSection('rewards')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                    </path>
                                    <polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline>
                                </svg>
                                View Rewards
                            </button>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>

    <!-- Request Pickup Section -->
    <div id="request-pickup-section" class="section">
        <div class="pickup-container">
            <div class="pickup-content">
                <div class="pickup-form-wrapper">
                    <h1>Schedule Waste Pickup</h1>
                    <p class="subtitle">Request a pickup for your organic waste and earn reward points</p>

                    <div class="pickup-card">
                        <h3>Pickup Details</h3>
                        <form id="pickupForm">
                            <div class="form-group">
                                <label for="wasteType">Waste Type *</label>
                                <select id="wasteType" required>
                                    <option value="">Select waste type</option>
                                    <option value="vegetable-peels">Vegetable Peels & Food Scraps</option>
                                    <option value="fruit-waste">Fruit Waste & Leftovers</option>
                                    <option value="mixed-organic">Mixed Organic Waste</option>
                                    <option value="coffee-grounds">Coffee Grounds</option>
                                    <option value="tea-leaves">Tea Leaves</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="quantity">Estimated Weight (kg) *</label>
                                <input type="number" id="quantity" placeholder="e.g., 2.5" min="0.5" step="0.1"
                                    required>
                            </div>

                            <div class="form-group ai-section">
                                <label>ü§ñ‚ú® AI Waste Classifier (Required)</label>
                                <input type="file" id="wasteImage" accept="image/*" required>
                                <button type="button" class="btn-primary" onclick="onClassifyClick()">
                                    Classify Image
                                </button>
                                <div id="aiResult" style="margin-top:10px; font-weight:600;"></div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pickupDate">Preferred Date *</label>
                                    <div class="date-input-wrapper">
                                        <input type="date" id="pickupDate" required>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="pickupTime">Preferred Time *</label>
                                    <select id="pickupTime" required>
                                        <option value="">Select time slot</option>
                                        <option value="09:00-12:00">09:00 - 12:00</option>
                                        <option value="12:00-15:00">12:00 - 15:00</option>
                                        <option value="15:00-18:00">15:00 - 18:00</option>
                                        <option value="18:00-20:00">18:00 - 20:00</option>
                                    </select>
                                </div>
                            </div>

                            <!-- In household-dashboard.html, inside the pickup form -->

                            <div class="form-group">
                                <label for="address">Pickup Address *</label>
                                <input type="text" id="address" placeholder="Enter your pickup address" required>
                                <button type="button" class="btn-secondary" onclick="showLocationPicker()"
                                    style="margin-top: 8px; width: 100%;">
                                    üìç Select Location on Map
                                </button>
                            </div>

                            <!-- Hidden map container -->
                            <div id="locationPickerModal"
                                style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 10000; padding: 20px;">
                                <div
                                    style="background: white; max-width: 800px; margin: 0 auto; padding: 24px; border-radius: 12px;">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                        <h3 style="margin: 0;">Select Your Location</h3>
                                        <button onclick="closeLocationPicker()"
                                            style="background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
                                    </div>
                                    <div id="locationPickerMap" style="height: 400px; width: 100%; border-radius: 8px;">
                                    </div>
                                    <div style="margin-top: 16px; display: flex; gap: 12px; justify-content: flex-end;">
                                        <button class="btn-secondary" onclick="closeLocationPicker()">Cancel</button>
                                        <button class="btn-primary" onclick="confirmLocation()">Confirm
                                            Location</button>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn-primary" disabled style="background:#94a3b8;">
                                üì∏ Classify waste first
                            </button>
                        </form>
                    </div>
                </div>

                <div class="pickup-sidebar"></div>
            </div>
        </div>
    </div>

    <!-- Pickup History Section -->
    <div id="pickup-history-section" class="section">
        <div class="history-container">
            <h1>Pickup History</h1>

            <!-- Upcoming Pickups -->
            <div class="history-section">
                <h2>Upcoming Pickups</h2>
                <div id="upcomingPickups">
                    <!-- Upcoming pickups will be loaded here -->
                </div>
            </div>

            <!-- Past Pickups -->
            <div class="history-section">
                <h2>Past Pickups</h2>
                <div id="pastPickups">
                    <!-- Past pickups will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Rewards Section -->
    <div id="rewards-section" class="section">
        <div class="rewards-container">
            <div class="rewards-layout">
                <div class="rewards-sidebar">
                    <div class="sidebar-card">
                        <h2 id="availablePointsDisplay">1850 Available Points</h2>
                    </div>
                </div>

                <div class="rewards-main">
                    <div class="rewards-header">
                        <div>
                            <h1>Rewards Center</h1>
                            <p>Redeem your points for exciting rewards and support local businesses</p>
                        </div>
                    </div>

                    <div id="rewardsGrid" class="rewards-grid"></div>
                    <div style="margin-top:24px;" class="content-card">
                        <h2>Redemption History</h2>
                        <div id="redemptionHistory">
                            <p class="empty-state">No redemption history yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
    <script src="js/household-dashboard.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
    <script src="js/ai-classifier.js"></script>

</body>

</html>